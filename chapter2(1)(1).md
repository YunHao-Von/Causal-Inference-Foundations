#chapter2
#潜在结果模型与因果效应的概念

###2.1 潜在结果模型的概念
潜在结果的几个重要基本概念：**单元、个体、干预、预测结果和协变量。**

**单元**：潜在结果模型中研究的单个对象被称为单元。

**干预**：干预是在某个时间点对单元进行一定的操作。干预又被成为处理。<u>没有干预就没有因果。</u>

**观测结果**：研究单元在实际中接受某种处理后观测到的结果就是观测结果。

**协变量**：研究单元的一些相关属性称为协变量。
在研究中它们随谈可能不是我们选择干预的变量，也可能不会被干预所影响，但是它们可能会给最终的结果带来影响。

**潜在结果**：潜在结果就是一个单元在潜在干预下出现的结果。潜在结果也被称为反事实结果。

由于一个个体在同一时间只能被实施一种干预，那么在一段时间后只能观测到该个体在该干预下的潜在结果。我们不能再进行了下一种干预后，重新穿越回去进行其他干预从而观测到这个个体在其他干预下的潜在结果。即对一个个体而言，不能同时观测到个体的所有潜在结果，因此我们不能评估干预对该个体的因果效应。

为计算个体因果效应，随机对照实验采用随机分配机制把研究的群体分成处理组和对照组，然后通过对比处理组和对照组之间的结果差异获得总体的平均因果效应，最后通过总体的平均因果效应来评估个体的因果效应。

**潜在结果模型**：潜在结果模型又被称为奈曼-鲁宾因果模型（Rubin Causal Model，RCM）
潜在结果模型的核心内容是通过对比同一个个体在接受指定干预和未接收指定干预后的潜在结果差异吗，评估这个干预对该个体是否有因果效应。

在潜在结果模型框架下，研究者给出了几个重要的假设来保证基于观测数据的处理组和对照组的相似性和可比性。

###2.2因果效应定义与假设
**个体因果效应**：假设i=1，2，···，n表示个体；$\tau_{i}$表示个体i的处理变量，并且$\tau_{i}$属于{0,1}表示2种不同的处理，并且假设个体i能够接受两种处理，用Yi（1）和Yi（0）分别表示有无某种处理时个体i的潜在结果。
个体i的个体因果效应为：$$\tau_{i}\triangleq Y_{i}\left(1\right)-Y_{i}\left(0\right)$$
个体效应又称为个体处理效应（individual treatment effect，ITE）

**平均因果效应**：
我们将接受处理T的样本划分到处理组，将未接收处理T的样本划分到对照组。通过将处理组和对照组中的所有个体的个体因果效应取平均值来得到平均因果效应。
在一个含有n个个体的随机试验中，个体是否接受处理是随机分配的。
**平均因果效应的定义**：当处理组个体和对照组个体的潜在观测结果分别为Yi（1）和Yi（0）时，群体的平均因果效应为：$$\tau\triangleq\mathbb{E}\left[Y_{i}\left(1\right)-Y_{i}\left(0\right)\right]=\mathbb{E}\left[Y\left(1\right)\right]-\mathbb{E}\left[Y\left(0\right)\right]$$
平均因果效应又称为平均处理效应（Average Treatment Effect，ATE）。平均因果效应是衡量处理组和对照组之间的平均因果差异。

ps：既然把群体分成了处理组和对照组，那么我们关心的是处理组和对照组的潜在结果Y（1）和Y（0）。一个个体在同一时间只能接受一种处理，并只能被观测到在该处理下的结果。为了把观测结果和潜在结果联系起来，需要基于：**一致性假设**。

**一致性假设**：
对于一个处理T，其相应地观测到的结果Y是在处理T下的潜在结果Y（T），即当T=t时，Y=Y（t）。
即让每个个体在某个处理下的潜在结果与该个体实际接受的该种处理下的观测结果相等。（可以理解为：在对i做实验前设想的是打疫苗，在实验时就需要打疫苗，而不能对i进行不打疫苗处理。）

ps：在考虑群体的因果效应时，需要考虑可能会出现在群体内的个体之间相互影响的情况，以及处理组（T=1）中的个体由于接受的处理形式不同而出现多种潜在结果的情况。此时就需要满足：**稳定单元处理值假设。**

**稳定单元处理值假设**：
1.每个个体的潜在结果不受其他个体所接受的处理值的影响。（相互独立）
2.对于每一个个体，每个处理水平没有不同的形式，从而不会导致不同的潜在结果。（处理方式一致）

**正值性假设**：
在研究的群体中，当P（X=x）>0时，都有0<P（T=t|X=x）< 1.
在随机对照试验中，事先选择的试验个体间应该差异不大或者不存在差异，随机分为处理组和对照组后，这两个组之间满足可交换性，即如果对照组的个体接受处理组接受的处理，其结果与原来的处理组的结果相同；同样地，如果处理组变为对照组，那么其结果与原来的对照组的结果相同，即处理变量与潜在结果相互独立。

**可交换性假设**：
当T为处理变量，Y（1）和Y（0）分别为接受处理和未接收处理的潜在结果时，$$(Y(1),Y(0))\perp T$$
即，潜在结果与处理变量是无关的，是相互独立的。

**异质性因果效应（Heterogeneous Causal Effect，HCE）**：
异质性因果效应的研究方法是将研究数据按照条件进行分组，比较平均处理效果在子组内的效应差异，因此又可以称为条件平均因果效应（Conditional Average Causal Effect）。

**条件可交换性假设**：
当T为处理变量，Y（1）和Y（0）分别为接受处理和未接受处理的潜在结果，且Z为协变量集时，$$\left(Y\left(1\right),Y\left(0\right)\right)\perp T|Z$$
即研究群体可以根据性别、年龄等其他协变量划分为子分组，使得根据协变量划分的每个子分组都满足可交换性，即在每个子分组中潜在结果和处理变量相互独立由于每个子分组具有了条件可交换性，那么在每个子分组中计算的因果效应就不会被混杂因子影响而产生混杂偏差。

**异质性因果效应**：
在Z相同的条件下，处理变量Ti条件独立于潜在结果Yi：$$T_{i}\perp\{Y_{i}(0),Y_{i}(1)\}|Z$$
群体的异质性因果效应的公式为：
$$\tau\triangleq\mathbb{E}\left[Y_{i}(1)-Y_{i}(0)|Z=z\right]=\mathbb{E}\left[Y(1)|Z=z\right]-\mathbb{E}\left[Y(0)|Z=z\right]$$